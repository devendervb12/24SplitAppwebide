sap.ui.define(["sap/ui/core/mvc/Controller"], function(Controller) {
	"use strict";
	return Controller.extend("smax.batch25Z24SPLITAPP.controller.DetailPage", {
		/**
		 * Called when a controller is instantiated and its View controls (if available) are already created.
		 * Can be used to modify the View before it is displayed, to bind event handlers and do other one-time initialization.
		 * @memberOf smax.batch25Z24SPLITAPP.view.DetailPage
		 */
		onInit: function() {
			// get the router from component
			var oRouter = this.getOwnerComponent().getRouter();
			oRouter.getRoute("toDetailPage").attachPatternMatched(function(oEvent) {
			this.productID = oEvent.getParameters().arguments.prod;
				this.getView().bindElement("/ProductSet('" + 	this.productID + "')");
			}, this);
		},
		/**
		 *@memberOf smax.batch25Z24SPLITAPP.controller.DetailPage
		 */
		onCreate: function() {
			//This code was generated by the layout editor.
			debugger;
		//	var that = this;
			
			var oDialog = new sap.m.Dialog({
			   title : "Add Product",
			   content : [
			   	new sap.m.Label({text : "Product ID" }),
			   	new sap.m.Input(),
			   	new sap.m.Label({ text : "Name"}),
			   	new sap.m.Input()
			   	],
			   buttons : [
			   	 new sap.m.Button({text : "Save & Close", press : function(oEvent){
			   	 
			   	 //	grab the componentmodel
			   	 //oModel.create
			   	 // this -> controller
			   	 
			   	 var data = {
			   	 	ProductID : oEvent.getSource().getParent().getContent()[1].getValue(),
			   	 	Name : oEvent.getSource().getParent().getContent()[3].getValue(),
			   	 	Category : 'PCs',
		            SupplierID : '0100000000'
			   	 };
			   	 	debugger;
			   	var oModel =  this.getOwnerComponent().getModel();
			   	oModel.create("/ProductSet", data, {
			   		success : function(){
			   			sap.m.MessageToast.show("Data Created");
			   		},
			   		error : function(){
			   			sap.m.MessageToast.show("Data not Created, contact administrator");	
			   		}
			   	});
			   	oEvent.getSource().getParent().close();
			   	
			   	 }.bind(this) }),
			   	 new sap.m.Button({text : "Cancel" ,press : function(){ oDialog.close();}})
			   	]	
			});
			oDialog.open();
		},
		onUpdate : function(){
			
			var oDialog = new sap.m.Dialog({
				title : "Update Product",
				 content : [
				 	new sap.m.VBox({
				 		items : [
				 			new sap.m.HBox({
				 				items : [
				 					 	new sap.m.Label({text : "Product ID" }),
										new sap.m.Text({ text : this.productID })
				 					]
				 			})
				 			] 
				 	}),
				  
				   	new sap.m.Label({ text : "Name"}),
				   	new sap.m.Input({ value : this.getView().byId("idProdName").getText()})
				   	],
				 buttons : [
				 	new sap.m.Button({ text : "Update and Close", press : function(oEvent){
				 
				    var productID = this.productID;
				    
				 	var data = {
				 			Name : oEvent.getSource().getParent().getContent()[2].getValue()
				 		};
				 		
				 	var oModel = this.getOwnerComponent().getModel();
				 	
				 	oModel.update("/ProductSet('"+productID+"')", data, {
				 		success : function(){
				 			sap.m.MessageToast.show("Data Updated");
				 		},
				 		error : function(){
				 				sap.m.MessageToast.show("Data Not Updated");
				 		}
				 	});
				 	
				 	oEvent.getSource().getParent().close();
				 		
				 	}.bind(this)}),
				 	new sap.m.Button({ text : "Cancel", press : function(){ oDialog.close();}})
				 	
				 	]  	
			});
			
			oDialog.open();
		}
	});
});